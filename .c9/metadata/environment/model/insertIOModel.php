{"filter":false,"title":"insertIOModel.php","tooltip":"/model/insertIOModel.php","undoManager":{"mark":4,"position":4,"stack":[[{"start":{"row":0,"column":0},"end":{"row":0,"column":1},"action":"insert","lines":["<"],"id":1},{"start":{"row":0,"column":1},"end":{"row":0,"column":2},"action":"insert","lines":["?"]},{"start":{"row":0,"column":2},"end":{"row":0,"column":3},"action":"insert","lines":["p"]},{"start":{"row":0,"column":3},"end":{"row":0,"column":4},"action":"insert","lines":["h"]},{"start":{"row":0,"column":4},"end":{"row":0,"column":5},"action":"insert","lines":["p"]}],[{"start":{"row":0,"column":5},"end":{"row":1,"column":0},"action":"insert","lines":["",""],"id":2},{"start":{"row":1,"column":0},"end":{"row":2,"column":0},"action":"insert","lines":["",""]}],[{"start":{"row":2,"column":0},"end":{"row":67,"column":5},"action":"insert","lines":["","    /*","     *   insert_prepared_imageUpload takes 6 arguments and querys a prepaired statment to call images","     *   exacutes the query and the takes the affeted rows","     *   checks the affected rows agains the expected rows","     *   returns true if affected rows are equal expected rows they match, and false if not","     */     ","    ","    function insert_prepared_imageUpload($dir, $ufilename, $uhash, $uowner, $uvirusFree, $expectedResult) {","        $connection = insertConnectionString($dir);","        // Check connection","        if ($connection->connect_error) {","            die(\"Connection failed: \" . $connection->connect_error);","        }","        $stmt = $connection->prepare(\"INSERT INTO images (filename, hash, owner, virusFree) VALUES (?,?,?,?)\");","        $filename = $ufilename;","        $hash = $uhash;","        $owner = $uowner;","        $virusFree = $uvirusFree;","        $stmt->bind_param(\"ssss\", $filename, $hash, $owner, $virusFree);","        $stmt->execute();","        $affectedRows = mysqli_stmt_affected_rows($stmt);","        // check expected result","        if($affectedRows != $expectedResult){","            //include(\"logs/logsMail.php\");","            return false;","        }else{","            return true;","        }","    }   ","    ","    /*","     *   insert_prepared_imageUploadTransaction takes 6 arguments and querys a prepaired statment to call images","     *   starts a transaction, exacutes the query and the takes the affeted rows","     *   checks the affected rows agains the expected rows","     *   returns true and commits the transaction if affected rows are equal, expected rows they match, and false and rolls back if not","     */ ","        ","    function insert_prepared_imageUploadTransaction($dir, $ufilename, $uhash, $uowner, $uvirusFree, $expectedResult) {","        $connection = insertConnectionString($dir);","        mysqli_autocommit($connection,FALSE);","        mysqli_query($connection,\"start transaction\"); ","        ","        // Check connection","        if ($connection->connect_error) {","            die(\"Connection failed: \" . $connection->connect_error);","        }","        $stmt = $connection->prepare(\"INSERT INTO images (filename, hash, owner, virusFree) VALUES (?,?,?,?)\");","        $filename = $ufilename;","        $hash = $uhash;","        $owner = $uowner;","        $virusFree = $uvirusFree;","        $stmt->bind_param(\"ssss\", $filename, $hash, $owner, $virusFree);","        $stmt->execute();","        $affectedRows = mysqli_stmt_affected_rows($stmt);","        // check expected result","        if($affectedRows != $expectedResult){","            //include(\"logs/logsMail.php\");","            mysqli_query($connection,\"rollback\");","            return false;","        }else{","            mysqli_query($connection,\"commit\");","            return true;","        }","        mysqli_close($connection);","    }"],"id":3}],[{"start":{"row":67,"column":5},"end":{"row":68,"column":0},"action":"insert","lines":["",""],"id":4},{"start":{"row":68,"column":0},"end":{"row":68,"column":4},"action":"insert","lines":["    "]},{"start":{"row":68,"column":4},"end":{"row":69,"column":0},"action":"insert","lines":["",""]},{"start":{"row":69,"column":0},"end":{"row":69,"column":4},"action":"insert","lines":["    "]},{"start":{"row":69,"column":4},"end":{"row":69,"column":5},"action":"insert","lines":["?"]},{"start":{"row":69,"column":5},"end":{"row":69,"column":6},"action":"insert","lines":[">"]}],[{"start":{"row":69,"column":0},"end":{"row":69,"column":4},"action":"remove","lines":["    "],"id":5}]]},"ace":{"folds":[],"scrolltop":358.5,"scrollleft":0,"selection":{"start":{"row":51,"column":23},"end":{"row":51,"column":23},"isBackwards":false},"options":{"guessTabSize":true,"useWrapMode":false,"wrapToView":true},"firstLineState":{"row":24,"state":"php-start","mode":"ace/mode/php"}},"timestamp":1523203982926,"hash":"766ea3866c2588650e3aa65a41ca6c30527a9e6c"}