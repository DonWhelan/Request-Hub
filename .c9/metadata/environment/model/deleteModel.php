{"filter":false,"title":"deleteModel.php","tooltip":"/model/deleteModel.php","undoManager":{"mark":6,"position":6,"stack":[[{"start":{"row":0,"column":0},"end":{"row":0,"column":1},"action":"insert","lines":["<"],"id":1},{"start":{"row":0,"column":1},"end":{"row":0,"column":2},"action":"insert","lines":["?"]},{"start":{"row":0,"column":2},"end":{"row":0,"column":3},"action":"insert","lines":["p"]},{"start":{"row":0,"column":3},"end":{"row":0,"column":4},"action":"insert","lines":["h"]},{"start":{"row":0,"column":4},"end":{"row":0,"column":5},"action":"insert","lines":["p"]}],[{"start":{"row":0,"column":5},"end":{"row":1,"column":0},"action":"insert","lines":["",""],"id":2},{"start":{"row":1,"column":0},"end":{"row":2,"column":0},"action":"insert","lines":["",""]},{"start":{"row":2,"column":0},"end":{"row":3,"column":0},"action":"insert","lines":["",""]},{"start":{"row":3,"column":0},"end":{"row":3,"column":1},"action":"insert","lines":["?"]},{"start":{"row":3,"column":1},"end":{"row":3,"column":2},"action":"insert","lines":[">"]}],[{"start":{"row":1,"column":0},"end":{"row":81,"column":5},"action":"insert","lines":["/*  ---------- DELETE Functions ---------- //","     *  delete_sqli(), delete_sqliLog() and delete_sqliTransaction() all use deleteConnectionString() which has SELECT, DELETE and LOCK only access to the DB","     *  each one takes in a SQL query as a argument and handles faild connections to the db server and the database its self","     */     ","    ","    function delete_sqli($dir,$delete_query){","        $connection = deleteConnectionString($dir);","        $queryresult = mysqli_query($connection, $delete_query)","        or die(mysqli_error($connection));","        mysqli_close($connection);","        return $queryresult;","    }","    ","    /* ","     *   delete_sqliLog() takes 3 arguments the query, the table and the expected amount of rows affected from that query","     *   if the effected number of rows does not match the what is thought, a security logs is created ","     *   The effected number of rows is calculated by compairing effected rows, and counting the rows before and after the delete ","     */      ","    ","    function delete_sqliLog($dir,$delete_query, $table, $expectedResult){","        $connection = deleteConnectionString();","        ","        $sql = \"Select * FROM $table\";","        $result = mysqli_query($connection,$sql); ","        $rowsBefore = mysqli_num_rows($result);","        ","        $queryresult = mysqli_query($connection, $delete_query) ","        or die(mysqli_error($connection));","        $affectedRows = mysqli_affected_rows($connection);","        ","        $sql = \"Select * FROM $table\";","        $result = mysqli_query($connection,$sql); ","        $rowsAfter = mysqli_num_rows($result);","        ","        if(($rowsBefore != ($rowsAfter + $expectedResult)) || ($affectedRows != $expectedResult)){","            if($affectedRows != 0){","                include(\"logs/logsMail.php\");","            }    ","        }","        mysqli_close($connection);","        return $queryresult;","    }","    ","    /*","     *   delete_sqliTransaction() takes 3 arguments the query, the table and the expected amount of rows affected from that query","     *   Before the query is run a transaction is started ","     *   if the effected number of rows does not match the what is thought, a security logs is created and the the transaction is rolled back","     *   The effected number of rows is calculated by compairing effected rows, and counting the rows before and after the delete ","     *   If the effected number of rows does match what is thought, the query is commited","     */      ","    ","    function delete_sqliTransaction($dir,$delete_query, $table, $expectedResult){","        $connection = deleteConnectionString($dir);","        mysqli_autocommit($connection,FALSE);","        mysqli_query($connection,\"start transaction\");         ","        ","        $sql = \"Select * FROM $table\";","        $result = mysqli_query($connection,$sql); ","        $rowsBefore = mysqli_num_rows($result);","        ","        $queryresult = mysqli_query($connection, $delete_query) ","        or die(mysqli_error($connection));","        $affectedRows = mysqli_affected_rows($connection);","        ","        $sql = \"Select * FROM $table\";","        $result = mysqli_query($connection,$sql); ","        $rowsAfter = mysqli_num_rows($result);","        ","        if(($rowsBefore != ($rowsAfter + $expectedResult)) || ($affectedRows != $expectedResult)){","            if($affectedRows != 0){","                include(\"logs/logsMail.php\");","                mysqli_query($connection,\"rollback\");","            }else{","                mysqli_query($connection,\"commit\");","            }    ","        }else{","            mysqli_query($connection,\"commit\");","        }","        mysqli_close($connection);","        return $queryresult;","    }"],"id":3}],[{"start":{"row":0,"column":5},"end":{"row":1,"column":0},"action":"insert","lines":["",""],"id":4},{"start":{"row":1,"column":0},"end":{"row":2,"column":0},"action":"insert","lines":["",""]},{"start":{"row":2,"column":0},"end":{"row":3,"column":0},"action":"insert","lines":["",""]}],[{"start":{"row":3,"column":0},"end":{"row":20,"column":6},"action":"insert","lines":["// deleteConnectionString() only has SELECT and DELETE permission on its account on the MYSQL Server.      ","    function deleteConnectionString($dir){","        // connection details are stored outside the web directory and are defined","        include($dir.\"../pem/sqlDelete.php\");","        $connection = mysqli_connect(dHOST, dUSER, dPASS);","        if (!$connection) {","            trigger_error(\"Could not reach database!<br/>\");","            include(\"logs/logsMail-1dir.php\");","            exit();","        }","        $db_selected = mysqli_select_db($connection, dDB);","        if (!$db_selected) {","            trigger_error(\"Could not reach database!<br/>\");","            include(\"logs/logsMail-1dir.php\");","            exit();","        } ","        return $connection;","    } "],"id":5}],[{"start":{"row":21,"column":0},"end":{"row":21,"column":4},"action":"insert","lines":["    "],"id":6}],[{"start":{"row":3,"column":0},"end":{"row":3,"column":4},"action":"insert","lines":["    "],"id":7}]]},"ace":{"folds":[],"scrolltop":0,"scrollleft":0,"selection":{"start":{"row":8,"column":27},"end":{"row":8,"column":27},"isBackwards":false},"options":{"guessTabSize":true,"useWrapMode":false,"wrapToView":true},"firstLineState":{"row":100,"state":"php-start","mode":"ace/mode/php"}},"timestamp":1523204267295,"hash":"664b22879423167e2fb0516d0129e59c2f2f3ffb"}